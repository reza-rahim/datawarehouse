#!/bin/bash
eval "$({{ secret_dir }}/{{ decrypt_file }})"; 

export SPARK_DAEMON_JAVA_OPTS="$SPARK_DAEMON_JAVA_OPTS \
  -Dzookeeper.clientCnxnSocket=org.apache.zookeeper.ClientCnxnSocketNetty 
  -Dzookeeper.client.secure=true 
  -Dzookeeper.ssl.keyStore.location={{ cert_dir }}javacert.keystore.jks
  -Dzookeeper.ssl.keyStore.password=changeit
  -Dzookeeper.ssl.trustStore.location={{ cert_dir }}javacert.truststore.jks
  -Dzookeeper.ssl.trustStore.password=changeit"

{{ spark_home }}/bin/spark-class org.apache.spark.deploy.master.Master \
	--host {{ inventory_hostname }}.{{ fqdn }} \
	--port  {{ spark_rpc_port }} \
	--webui-port {{ spark_webui_port }} \
	--properties-file {{ spark_mnaster_conf_dir }}/ha.conf
