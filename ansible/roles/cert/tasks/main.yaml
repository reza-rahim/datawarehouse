- name: create {{ cert_dir }} dir
  file:
     path: '{{ cert_dir }}'
     state: directory
     group: '{{ application_group }}'

- name: copy  cert files
  template: src='{{ item.src }}' dest='{{ item.dest }}' group='{{ application_group }}'  mode=0640
  loop:
     - { src: '{{ server_cert_file_name }}', dest: '{{ cert_dir }}/{{ server_cert_file_name }}'  }
     - { src: '{{ server_key_file_name }}', dest: '{{ cert_dir }}/{{ server_key_file_name }}'  }
     - { src: '{{ server_cert_key_file_name }}', dest: '{{ cert_dir }}/{{ server_cert_key_file_name }}'  }

- name: Create {{ cert_dir }} directory
  file:
    path: "{{ minio_home_cert }}"
    state: directory
    mode: '0750'
    owner: "{{ minio_user }}"
    group: "{{ minio_group }}"
       
       
- name: copy  cert files for minio
  template: src='{{ item.src }}' dest='{{ item.dest }}' group='{{ application_group }}'  mode=0640       
  loop:
     - { src: '{{ server_cert_file_name }}', dest: '{{ minio_home_cert }}/public.crt'  }
     - { src: '{{ server_key_file_name }}', dest: '{{ minio_home_cert}}/private.key'  }

- name: copy  {{ ca_cert_file_name }} to /usr/local/share/ca-certificates/
  template: src='{{ item.src }}' dest='{{ item.dest }}'
  loop:
     - { src: '{{ ca_cert_file_name }}', dest: '/usr/local/share/ca-certificates/{{ ca_cert_file_name }}' }
   #notify: run certificates
  

- name:  run /usr/sbin/update-ca-certificates
  shell: /usr/sbin/update-ca-certificates


- name: Add the {{ ca_cert_file_name }} to Java truststore if not present as rootCA
  shell: |
    yes | keytool -importcert -trustcacerts \
    -alias rootCA \
    -file /usr/local/share/ca-certificates/rootCA.crt  \
    -keystore {{ java_home }}/lib/security/cacerts \
    -storepass changeit
  ignore_errors: yes


- name: Add the {{ ca_cert_file_name }} to Java truststore if not present as rootCA
  shell: |
    yes | keytool -import -trustcacerts -alias rootCA \
    -file /usr/local/share/ca-certificates/{{ ca_cert_file_name }} \
    -keystore /etc/ssl/certs/java/cacerts \
    -storepass changeit
  ignore_errors: yes    
